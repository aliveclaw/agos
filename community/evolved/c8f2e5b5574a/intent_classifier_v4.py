"""Evolved strategy: Intent Classifier

Auto-generated by agos evolution engine.
Source paper: 2602.14185v1
Target module: intent
Generated: 2026-02-17T02:51:23.139830
Defines: classify_intent

Sandbox output: Classified 4 intents correctly
PASS: Intent classifier validated

"""

from __future__ import annotations

from typing import Any

from agos.evolution.integrator import IntegrationStrategy, EvolutionProposal


# ── Evolved pattern code ──────────────────────────────────────────
# This code passed sandbox validation before being written here.

import math

INTENT_RULES = {
    'research': ['search', 'find', 'look up', 'investigate', 'analyze'],
    'code': ['write', 'implement', 'fix', 'refactor', 'build'],
    'review': ['review', 'check', 'audit', 'inspect', 'validate'],
    'monitor': ['watch', 'track', 'alert', 'detect', 'observe'],
    'automate': ['schedule', 'trigger', 'automate', 'repeat', 'cron'],
}

def classify_intent(text):
    text_lower = text.lower()
    scores = {}
    for intent, keywords in INTENT_RULES.items():
        score = sum(1 for kw in keywords if kw in text_lower)
        if score > 0:
            scores[intent] = score
    if not scores:
        return 'unknown', 0.0
    best = max(scores, key=scores.get)
    conf = scores[best] / max(len(INTENT_RULES[best]), 1)
    return best, round(conf, 3)

tests = [
    ('search for recent papers on memory', 'research'),
    ('write a function to sort items', 'code'),
    ('review the security audit logs', 'review'),
    ('watch for anomalies and alert', 'monitor'),
]
for text, expected in tests:
    intent, conf = classify_intent(text)
    assert intent == expected, f'{text!r}: got {intent}, expected {expected}'
print(f'Classified {len(tests)} intents correctly')
print('PASS: Intent classifier validated')


# ── Strategy wrapper ──────────────────────────────────────────────


class IntentClassifierStrategy(IntegrationStrategy):
    """Evolved strategy wrapping: Intent Classifier"""

    name = "intent_classifier"
    target_module = "intent"

    def __init__(self, **kwargs: Any) -> None:
        self._kwargs = kwargs
        self._applied = False

    def validate(self, proposal: EvolutionProposal) -> tuple[bool, str]:
        return True, ""

    async def snapshot(self) -> dict[str, Any]:
        return {"applied": self._applied}

    async def apply(self, proposal: EvolutionProposal) -> list[str]:
        self._applied = True
        return [
            "Applied evolved pattern: Intent Classifier",
            "Source: 2602.14185v1",
        ]

    async def rollback(self, snapshot_data: dict[str, Any]) -> None:
        self._applied = snapshot_data.get("applied", False)

    async def health_check(self) -> bool:
        return True
